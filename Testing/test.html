<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href=""> -->
    <title>Testing Document</title>
<style>
    img{
        width:100%;
        max-width:100px;
    }</style>
</head>

<body>
    <div id="testHere"></div>
    
</body>
<script src="../Testing/PlaylistJSONdata.js"></script>
<script src="../Testing/CityJSONdata.js"></script>
<script>
    var testDiv = document.getElementById('testHere');

    var cityStore = JSON.parse(localStorage.getItem('cityData'));
var newText="";
    for(i=0 ; i<10 ; i++){

newText += 
(i+1)
+ ": " +
"<img src=" + cityStore.obj[i].image_url + " >"
+
'<b>' + cityStore.obj[i].name + ",</b> "+ cityStore.obj[i].artist_names 
+ 
 "<br> ";
    }
    
    testDiv.innerHTML = newText ;

    

    var token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MjY2OTg2NiwidGltZXN0YW1wIjoxNjU2ODQwNjIxNDc2LCJpYXQiOjE2NTY4NDA2MjEsImV4cCI6MTY1Njg0NDIyMX0.oTkTGvl7Pl16_AIGhD9m9v7P4MDzTEdAGKd0iFH2qGg";

    var testUrl = 'https://api.chartmetric.com/api/city/7060/shazam/top-tracks'

  /*  ---- This section is supposed to be the refresh token bit. Use curl supplied and get
        //curl -d "{\"refreshtoken\":\"REFRESH_TOKEN\"}" -H "Content-Type: application/json" -X POST https://api.chartmetric.com/api/token
        var refreshUrl = 'https://api.chartmetric.com/api/token';
        var refToken = ""; //When we get this working, possibly put API  refresh tokenkey here
    
        fetch(refreshUrl, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
              //  "Access-Control-Allow-Origin": document.location,
            },
            data: {
                "refreshtoken": refToken,
            },
            mode: 'no-cors',
    
        }).then(function (response) {
            if (response.ok) {
                console.log('refresh response OK:');
                console.log(response.json());
                return response.json();
            }
            console.log('refresh response !OK:');
                console.log(response.json());
    //        throw response;
        }).then(function (data) {
    
            console.log(data);
        }).catch(function (error) {
            console.log(error);
        });
       // ----- End of refresh token ----- */


    //learnt from https://gomakethings.com/api-authentication-with-vanilla-js/

    fetch(testUrl, {
       // method: 'GET',
        headers: {
            // 'Authorization':  token ,
            'Authorization': 'Bearer ' + token ,
            //  'Access-Control-Allow-Origin': 'https://api.chartmetric.com',
            // 'Access-Control-Allow-Origin': "158.140.193.68",
            // 'url': document.location,
        },
        mode: "no-cors",
    }).then(function (response) {
        if (response.ok) {
            console.log('test response OK:');
            console.log(response);
            return response.json();
        }
        console.log('test response !OK:');
        console.log(response);
        throw response;
    }).then(function (data) {
        console.log(data);
        testDiv.textContent = data;
    }).catch(function (error) {
        console.warn(error);
    });

</script>

</html>